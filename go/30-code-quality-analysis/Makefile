.PHONY: format vet test quality clean help

# VariÃ¡veis
GO := go
GOIMPORTS := goimports
PACKAGES := ./...

# Ajuda
help:
	@echo "Comandos disponÃ­veis:"
	@echo "  make format    - Formatar cÃ³digo com goimports"
	@echo "  make vet       - Verificar qualidade com go vet"
	@echo "  make test      - Executar testes"
	@echo "  make quality   - Executar todas as verificaÃ§Ãµes"
	@echo "  make clean     - Limpar arquivos gerados"
	@echo "  make help      - Mostrar esta ajuda"

# Formatar cÃ³digo
format:
	@echo "ğŸ“ Formatando cÃ³digo com goimports..."
	@$(GOIMPORTS) -w $(PACKAGES)
	@echo "âœ… FormataÃ§Ã£o concluÃ­da!"

# Verificar qualidade
vet:
	@echo "ğŸ” Verificando qualidade com go vet..."
	@$(GO) vet $(PACKAGES)
	@echo "âœ… VerificaÃ§Ã£o concluÃ­da!"

# Executar testes
test:
	@echo "ğŸ§ª Executando testes..."
	@$(GO) test -v $(PACKAGES)
	@echo "âœ… Testes concluÃ­dos!"

# Verificar formataÃ§Ã£o (sem modificar)
check-format:
	@echo "ğŸ” Verificando formataÃ§Ã£o..."
	@if [ "$$($(GOIMPORTS) -l $(PACKAGES) | wc -l)" -gt 0 ]; then \
		echo "âŒ CÃ³digo nÃ£o estÃ¡ formatado corretamente:"; \
		$(GOIMPORTS) -l $(PACKAGES); \
		exit 1; \
	fi
	@echo "âœ… FormataÃ§Ã£o OK!"

# Tudo junto: qualidade completa
quality: format vet test
	@echo ""
	@echo "âœ… Qualidade verificada com sucesso!"
	@echo "ğŸ“Š Resumo:"
	@echo "   - CÃ³digo formatado âœ“"
	@echo "   - go vet passou âœ“"
	@echo "   - Testes passaram âœ“"

# Limpar
clean:
	@echo "ğŸ§¹ Limpando arquivos gerados..."
	@$(GO) clean
	@echo "âœ… Limpeza concluÃ­da!"

# Instalar goimports se nÃ£o estiver instalado
install-tools:
	@echo "ğŸ“¦ Instalando ferramentas..."
	@$(GO) install golang.org/x/tools/cmd/goimports@latest
	@echo "âœ… Ferramentas instaladas!"

